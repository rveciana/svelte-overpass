var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(t,e){t.appendChild(e)}function l(t,e,n){t.insertBefore(e,n||null)}function s(t){t.parentNode.removeChild(t)}function c(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function d(){return u(" ")}function h(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function f(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function p(t,e){for(let n=0;n<t.options.length;n+=1){const o=t.options[n];if(o.__value===e)return void(o.selected=!0)}}let g,m;function v(){if(void 0===g){g=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(t){g=!0}}return g}function w(t){m=t}function b(t){(function(){if(!m)throw new Error("Function called outside component initialization");return m})().$$.on_mount.push(t)}const $=[],y=[],M=[],_=[],k=Promise.resolve();let x=!1;function E(t){M.push(t)}let A=!1;const T=new Set;function P(){if(!A){A=!0;do{for(let t=0;t<$.length;t+=1){const e=$[t];w(e),S(e.$$)}for(w(null),$.length=0;y.length;)y.pop()();for(let t=0;t<M.length;t+=1){const e=M[t];T.has(e)||(T.add(e),e())}M.length=0}while($.length);for(;_.length;)_.pop()();x=!1,A=!1,T.clear()}}function S(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(E)}}const I=new Set;function O(t,e){-1===t.$$.dirty[0]&&($.push(t),x||(x=!0,k.then(P)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function W(i,a,l,c,u,d,h=[-1]){const f=m;w(i);const p=a.props||{},g=i.$$={fragment:null,ctx:null,props:d,update:t,not_equal:u,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(f?f.$$.context:[]),callbacks:n(),dirty:h,skip_bound:!1};let v=!1;if(g.ctx=l?l(i,p,((t,e,...n)=>{const o=n.length?n[0]:e;return g.ctx&&u(g.ctx[t],g.ctx[t]=o)&&(!g.skip_bound&&g.bound[t]&&g.bound[t](o),v&&O(i,t)),e})):[],g.update(),v=!0,o(g.before_update),g.fragment=!!c&&c(g.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);g.fragment&&g.fragment.l(t),t.forEach(s)}else g.fragment&&g.fragment.c();a.intro&&((b=i.$$.fragment)&&b.i&&(I.delete(b),b.i($))),function(t,n,i){const{fragment:a,on_mount:l,on_destroy:s,after_update:c}=t.$$;a&&a.m(n,i),E((()=>{const n=l.map(e).filter(r);s?s.push(...n):o(n),t.$$.on_mount=[]})),c.forEach(E)}(i,a.target,a.anchor),P()}var b,$;w(f)}var N=.9996,C=.00669438,L=Math.pow(C,2),R=Math.pow(C,3),j=C/(1-C),z=1-C/4-3*L/64-5*R/256,H=3*C/8+3*L/32+45*R/1024,q=15*L/256+45*R/1024,B=35*R/3072,U=6378137,X="CDEFGHJKLMNPQRSTUVWXX";function D(t,e,n){if(t>84||t<-80)throw new RangeError("latitude out of range (must be between 80 deg S and 84 deg N)");if(e>180||e<-180)throw new RangeError("longitude out of range (must be between 180 deg W and 180 deg E)");var o,r=F(t),i=Math.sin(r),a=Math.cos(r),l=Math.tan(r),s=Math.pow(l,2),c=Math.pow(l,4);o=void 0===n?function(t,e){if(56<=t&&t<64&&3<=e&&e<12)return 32;if(72<=t&&t<=84&&e>=0){if(e<9)return 31;if(e<21)return 33;if(e<33)return 35;if(e<42)return 37}return Math.floor((e+180)/6)+1}(t,e):n;var u=function(t){return-80<=t&&t<=84?X[Math.floor((t+80)/8)]:null}(t),d=F(e),h=F(function(t){return 6*(t-1)-180+3}(o)),f=U/Math.sqrt(1-C*i*i),p=j*a*a,g=a*(d-h),m=Math.pow(g,2),v=Math.pow(g,3),w=Math.pow(g,4),b=Math.pow(g,5),$=Math.pow(g,6),y=U*(z*r-H*Math.sin(2*r)+q*Math.sin(4*r)-B*Math.sin(6*r)),M=N*(y+f*l*(m/2+w/24*(5-s+9*p+4*p*p)+$/720*(61-58*s+c+600*p-330*j)));return t<0&&(M+=1e7),{easting:N*f*(g+v/6*(1-s+p)+b/120*(5-18*s+c+72*p-58*j))+5e5,northing:M,zoneNum:o,zoneLetter:u}}function F(t){return t*Math.PI/180}const G=(t,e,n,o)=>{var r,i;if(0===e)return;t.width=e,t.height=e;const a=t.getContext("2d");J(a,o),a.save(),a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowColor="black",a.shadowBlur=4,a.strokeStyle="gray",a.fillStyle="blanchedalmond",a.textAlign="center",a.lineWidth=4,a.translate(a.canvas.width/2,a.canvas.height/2);const l=(null===(r=n[0])||void 0===r?void 0:r.dist)||0,s=(null===(i=n[9])||void 0===i?void 0:i.dist)||0;n.forEach(((t,e)=>{if(e<=10){const e=-Math.PI/2+Math.PI*(t.dir-o)/180,r=(n=t.dist,a.canvas.width/4+a.canvas.width/5*(n-l)/(s-l));a.strokeText(t.name,r*Math.cos(e),r*Math.sin(e)),a.fillText(t.name,r*Math.cos(e),r*Math.sin(e))}var n})),a.rotate(Math.PI/2),a.restore()},J=(t,e)=>{const n=t.canvas.width/2,o=t.canvas.height/2;t.save(),t.translate(n,o),t.rotate(-Math.PI*e/180),t.font="14px Arial";const r=["N","E","S","W"];for(let e=0;e<4;e++)t.beginPath(),t.moveTo(0,0),t.lineTo(0,-o/2),t.lineTo(-n/12,-o/12),t.lineTo(0,0),t.fill(),t.beginPath(),t.moveTo(0,0),t.lineTo(0,-o/2),t.lineTo(n/12,-o/12),t.lineTo(0,0),t.stroke(),t.fillText(r[e],-5,-5-o/2),t.rotate(Math.PI/2);t.restore()};function K(t,e,n){const o=t.slice();return o[21]=e[n],o}function Q(e){let n,o,r,i,h=e[21].label+"";return{c(){n=c("option"),o=u(h),r=d(),n.__value=i=e[21].value,n.value=n.__value},m(t,e){l(t,n,e),a(n,o),a(n,r)},p:t,d(t){t&&s(n)}}}function V(e){let n,r,i,g,m,w,b,$,y,M,_,k,x,A=e[5],T=[];for(let t=0;t<A.length;t+=1)T[t]=Q(K(e,A,t));return{c(){n=c("main"),r=c("canvas"),i=d(),g=c("select");for(let t=0;t<T.length;t+=1)T[t].c();m=d(),w=c("div"),w.innerHTML='Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',b=d(),$=c("button"),y=u("Install app"),f(g,"id","amenity-select"),void 0===e[3]&&E((()=>e[15].call(g))),f(w,"class","copyright svelte-1kkscar"),f($,"id","btnInstallApp"),f($,"class","installAppBanner"),f($,"style",M="display :"+(e[4]?"block":"none")),f(n,"class","svelte-1kkscar"),E((()=>e[16].call(n)))},m(t,o){l(t,n,o),a(n,r),e[14](r),a(n,i),a(n,g);for(let t=0;t<T.length;t+=1)T[t].m(g,null);p(g,e[3]),a(n,m),a(n,w),a(n,b),a(n,$),a($,y),_=function(t,e){"static"===getComputedStyle(t).position&&(t.style.position="relative");const n=c("iframe");n.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),n.setAttribute("aria-hidden","true"),n.tabIndex=-1;const o=v();let r;return o?(n.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",r=h(window,"message",(t=>{t.source===n.contentWindow&&e()}))):(n.src="about:blank",n.onload=()=>{r=h(n.contentWindow,"resize",e)}),a(t,n),()=>{(o||r&&n.contentWindow)&&r(),s(n)}}(n,e[16].bind(n)),k||(x=[h(g,"change",e[15]),h($,"click",e[6])],k=!0)},p(t,[e]){if(32&e){let n;for(A=t[5],n=0;n<A.length;n+=1){const o=K(t,A,n);T[n]?T[n].p(o,e):(T[n]=Q(o),T[n].c(),T[n].m(g,null))}for(;n<T.length;n+=1)T[n].d(1);T.length=A.length}40&e&&p(g,t[3]),16&e&&M!==(M="display :"+(t[4]?"block":"none"))&&f($,"style",M)},i:t,o:t,d(t){t&&s(n),e[14](null),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(T,t),_(),k=!1,o(x)}}}function Y(t,e,n){let o,r,i=0,a=0,l=0,s=0,c=0,u=0,d=0,h=[],f="bar";const p=[{value:"bar",label:"Bar"},{value:"restaurant",label:"Restaurant"},{value:"school",label:"School"},{value:"place_of_worship",label:"Place of Worship"}];let g,m=!1;b((()=>{navigator.geolocation?navigator.geolocation.watchPosition(w,(()=>{console.log("ERROR")}),{enableHighAccuracy:!1,timeout:6e4,maximumAge:0}):alert("NO GEOLOCATION"),window.addEventListener("deviceorientationabsolute",v),window.addEventListener("beforeinstallprompt",$)}));const v=t=>{var e,o;if(!t.alpha)return void n(11,d=0);const r=(null!==(o=null===(e=null===screen||void 0===screen?void 0:screen.orientation)||void 0===e?void 0:e.type)&&void 0!==o?o:"portrait-primary").split("-"),i="portrait"===r[0]?0:90,a="secondary"===r[1]?i-180:i;n(11,d=a-t.alpha)},w=t=>{n(7,l=t.coords.longitude),n(8,s=t.coords.latitude),n(9,({easting:c,northing:u}=D(s,l)),c,n(10,u))},$=t=>{console.log("app install called"),t.preventDefault(),g=t,n(4,m=!0),console.log("app install call complete")};return t.$$.update=()=>{if(1928&t.$$.dirty){fetch(`https://overpass.kumi.systems/api/interpreter?data=[out:json][timeout:25000];node["amenity"="${f}"](around:1000,${s},${l});out body;>;out skel qt;`).then((t=>t.json())).then((t=>{n(12,h=t.elements.map((t=>{const{easting:e,northing:n}=D(t.lat,t.lon),o=Math.sqrt(Math.pow(e-c,2)+Math.pow(n-u,2)),r=180/Math.PI*Math.atan2((e-c)/o,(n-u)/o);return{name:t.tags.name,lng:t.lon,lat:t.lat,dist:o,dir:r}})).filter((t=>void 0!==t.name)).sort(((t,e)=>t.dist-e.dist)))})).catch((t=>{console.error("There has been a problem with the overpass API:",t)}))}3&t.$$.dirty&&n(13,o=Math.min(a>i?i:a,500)),14340&t.$$.dirty&&G(r,o,h,d)},[i,a,r,f,m,p,t=>{n(4,m=!1),g.prompt(),g.userChoice.then((t=>{"accepted"===t.outcome?(n(4,m=!1),console.log("User accepted the A2HS prompt")):console.log("User dismissed the A2HS prompt"),g=null}))},l,s,c,u,d,h,o,function(t){y[t?"unshift":"push"]((()=>{r=t,n(2,r)}))},function(){f=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(3,f),n(5,p)},function(){a=this.clientWidth,i=this.clientHeight,n(1,a),n(0,i)}]}const Z=new class extends class{$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),W(this,t,Y,V,i,{})}}({target:document.body});return"serviceWorker"in navigator&&navigator.serviceWorker.register("./service-worker.js"),Z}();
//# sourceMappingURL=bundle.js.map
